---
tags:
  - 1С
---
## Тонкий клиент и веб-клиент
Тонкий клиент является Windows-приложением и имеет более широкие возможности работы с файлами. В частности, он поддерживает множественный экспорт и импорт файлов и предоставляет программные средства для работы с локальной файловой системой клиентского компьютера.

Для того чтобы веб-клиент смог выполнять такие же действия, на клиентском компьютере необходимо установить и подключить расширение работы с файлами. Это отдельный компонент платформы, его установка и подключение выполняются автоматически средствами встроенного языка. Но установка этого расширения должна быть интерактивной. Пользователь должен самостоятельно принять решение об установке.

Однако использование расширения работы с файлами снижает общую безопасность системы: в браузере Microsoft Internet Explorer требуется разрешение на установку и использование ActiveX, а в браузере Mozilla Firefox необходимо предоставление расширенных привилегий. Пользователь веб-клиента попросту может не иметь подобных прав, если работа выполняется на публичном компьютере или в организации, использующей определенную политику безопасности.

Поэтому при работе с файлами и картинками следует в обязательном порядке реализовывать алгоритмы, использующие стандартные, общие для тонкого и веб-клиента возможности работы с файлами. Кроме того, можно реализовать и другую ветку алгоритма, использующую расширенные возможности работы с файлами. Но эта ветка должна быть опциональной, дополнительной. Нельзя обязательно заставлять пользователя использовать расширение работы с файлами, ведь у него может не быть прав на его установку.

---
## Стандартные возможности работы с файлами

Стандартные возможности работы с файлами реализуются двумя методами встроенного языка: `НачатьПомещениеФайла()` и `ПолучитьФайл()`.

_`НачатьПомещениеФайла()`_ – помещает файл из локальной файловой системы во временное хранилище.

_`ПолучитьФайл()`_ – получает файл из информационной базы и помещает его на клиентский компьютер.
## Помещение файла в ИБ

Помещение файла в информационную базу выполняется в два этапа. Сначала с помощью метода _`НачатьПомещениеФайла()`_ файл с клиентского компьютера помещается во _временное хранилище_ (рис. 3.150).

![[Pasted image 20240724114712.png]]

Временное хранилище – это набор служебных файлов кластера, в которых в течение ограниченного времени могут храниться произвольные данные до помещения их в базу данных.

На втором этапе, когда пользователь принимает решение сохранить редактируемые данные в базе данных, файл из временного хранилища помещается в какой-либо реквизит, имеющий тип _`ХранилищеЗначения`_, и эти данные записываются в базу данных (рис. 3.151).

![[Pasted image 20240724115107.png]]

Если же пользователь отказывается от сохранения редактируемых данных, то файл удаляется из временного хранилища либо автоматически, когда будет закрыта форма, с помощью которой он туда был помещен, либо «вручную», из встроенного языка.

Процесс получения файла из информационной базы проще. Он выполняется в один этап, с помощью метода _`ПолучитьФайл()`_ (рис. 3.152).

![[Pasted image 20240724115147.png]]

Файл извлекается из реквизита типа _`ХранилищеЗначения`_ и помещается на компьютер пользователя.

С помощью этого метода можно получить на клиентский компьютер данные не только из базы данных, но и из временного хранилища. При работе с файлами эта возможность имеет малое практическое значение. Зато она востребована, например, в тех случаях, когда временное хранилище используется для передачи больших массивов данных между двумя формами на клиенте.

---
### После помещения файла

Итак, после помещения файл окажется во временном хранилище, а в реквизитах формы будет ссылка на него.

![[Pasted image 20240724125551.png]]

Примечательным здесь является то, что при помещении файла мы указали последний параметр метода _`НачатьПомещениеФайла()` ._

```js
ОписаниеОповещения = Новый ОписаниеОповещения("ЗавершениеВыбораКартинки", ЭтотОбъект);

НачатьПомещениеФайла(ОписаниеОповещения, , , Истина, УникальныйИдентификатор);
```

В качестве этого параметра мы передали уникальный идентификатор нашей открытой формы. Это значит, что файл во временном хранилище будет существовать до тех пор, пока мы не закроем форму. Тогда платформа автоматически удалит его из хранилища. Значит, если пользователь откажется от сохранения изменений, сделанных в форме, нам не нужно заботиться об удалении файла из временного хранилища – платформа это сделает сама.

А вот если пользователь решит сохранить сделанные изменения, тогда будут выполнены следующие действия.
### Перед записью на сервере

Сначала на сервере будет вызван обработчик события формы _Перед записью на сервере_

```js
&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)

	Если ЭтоАдресВременногоХранилища(АдресКартинки) Тогда
		ТекущийОбъект.ДанныеФайлаКартинки = Новый ХранилищеЗначения(ПолучитьИзВременногоХранилища(АдресКартинки));
	КонецЕсли;

КонецПроцедуры

```

```js
Если ЭтоАдресВременногоХранилища(СсылкаНаФайлВоВременномХранилище) Тогда
```

В этом случае мы получим из временного хранилища двоичные данные и преобразуем их в объект _`ХранилищеЗначения`_, который и поместим в реквизит записываемого объекта

Таким образом, после выполнения этого обработчика мы будем иметь следующую картину

![[Pasted image 20240724130346.png]]

Затем платформа начнет запись объекта, и его данные будут помещены в базу данных

![[Pasted image 20240724130426.png]]
### При записи на сервере

После этого, еще до окончания транзакции записи, на сервере будет вызван обработчик события формы _При записи на сервере_

```js
&НаСервере
Процедура ПриЗаписиНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)

	Если ЭтоАдресВременногоХранилища(АдресКартинки) Тогда
		УдалитьИзВременногоХранилища(АдресКартинки)
	КонецЕсли;

КонецПроцедуры

```

В этом обработчике мы «наведем красоту». Так как данные объекта уже записаны в базу данных, полученный файл успешно сохранен, можно удалить из временного хранилища находящийся там файл. Для этого мы используем ссылку, сохраненную в реквизите формы.

![[Pasted image 20240724130851.png]]

Теоретически можно этого и не делать: платформа все равно автоматически удалит этот файл, когда мы закроем форму. Но в общем случае при интенсивной многопользовательской работе лучше освобождать ресурсы сервера сразу же после того, как необходимость в них исчезает.
### Получение файла из ИБ

Процесс получения файла из информационной базы выглядит гораздо проще.

```js
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	АдресКартинки = ПолучитьНавигационнуюСсылку(Объект.Ссылка, "ДанныеФайлаКартинки");

КонецПроцедуры
```

Навигационную ссылку мы получаем, указывая ссылку на объект и указывая имя реквизита объекта, в котором хранится файл.
